(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7805],{16821:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(42874),n=s(80498),a=s(3176),i=s(65259),l=s(20318);let o=()=>a.A.apiUrl+"/connect/update";class d{static getInstance(e){return(0,r._)(d,d,c)||(0,n._)(d,d,c,new d(e)),(0,r._)(d,d,c)}setOrgId(e){this.orgId=e}on(e,t){this.listener.add(t),"not_connected"===this.status&&this.connect()}off(e){this.listener.remove(e)}connect(){if("not_connected"!==this.status)return;this.changeStatus("connecting");let e=[],t=i.A.token();t&&e.push("access_token="+t),this.orgId&&e.push("org_id="+this.orgId);let s=e.length?"?"+e.join("&"):"";this.socket=new WebSocket(o()+s),this.socket.addEventListener("open",()=>this.changeStatus("connected")),this.socket.addEventListener("close",()=>{this.changeStatus("not_connected"),console.log("WebSocket closed")}),this.socket.addEventListener("message",e=>{try{let t=JSON.parse(e.data);this.listener.trigger(t)}catch(t){console.error("Invalid WebSocket message:",e.data)}})}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}disconnect(){if(this.socket)try{this.socket.close()}catch(e){console.error("Error closing WebSocket:",e)}}changeStatus(e){this.status!==e&&(this.status=e)}constructor(e){this.status="not_connected",this.socket=null,this.orgId=e,this.listener=new l.A}}var c={writable:!0,value:null};let u=d},32722:(e,t,s)=>{"use strict";function r(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}s.d(t,{_:()=>r})},35712:(e,t,s)=>{"use strict";function r(e,t){if(void 0===e)throw TypeError("attempted to "+t+" private static field before its declaration")}s.d(t,{_:()=>r})},42874:(e,t,s)=>{"use strict";s.d(t,{_:()=>a});var r=s(32722),n=s(35712);function a(e,t,s){return(0,r._)(e,t),(0,n._)(s,"get"),s.get?s.get.call(e):s.value}},70430:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var r=s(37876),n=s(14232),a=s(74562),i=s(65259),l=s(43598),o=s(49034);let d=e=>{let{id:t,args:s,setRefetchQuery:o}=e,[d,x]=(0,n.useState)(!1),[h,g]=(0,n.useState)(null),[f,p]=(0,n.useState)([]),b=e=>{let t=f.find(t=>t.id===e.target.id);t&&(t.value=e.target.value),p(f.map(s=>s.id===e.target.id&&null!=t?t:s))},y=async e=>{e.preventDefault();let s=Object.fromEntries(new FormData(e.target));for(let e in s){let t=s[e].toString().trim();if(!t)return;s[e]=t}x(!0);let r=await i.A.doPost({path:"/orgs/".concat(l.A.current().id,"/querysets/").concat(t),data:{data:{args:s}}});if(r.error){g(r.error.message);return}r.data&&(a.A.hide(),o(e=>!e)),x(!1)},v=(0,n.useCallback)(async()=>{let{data:e,error:t}=await i.A.doGet({path:"/orgs/".concat(l.A.current().id,"/aeo/workflows")});if(t){g("Error fetching workflows"),console.log(t.message);return}e&&p(e.workflows.filter(e=>"qgen"===e.type)[0].args.filter(e=>e.used_for.includes("analysis")).map(e=>({...e,value:s[e.id]})))},[s]);return(0,n.useEffect)(()=>{v()},[v]),(0,r.jsxs)("form",{className:"max-h-[60vh] overflow-auto flex flex-col",onSubmit:y,children:[(0,r.jsx)("div",{children:f.length>0&&f.map(e=>"textarea"===e.editor?(0,r.jsx)(u,{id:e.id,name:e.name,value:e.value,description:e.description,required:e.required},e.id):"country_dropdown"===e.editor?(0,r.jsx)(m,{id:e.id,name:e.name,value:e.value,description:e.description,required:e.required},e.id):(0,r.jsx)(c,{id:e.id,name:e.name,value:e.value,changeHandler:b,description:e.description,required:e.required},e.id))}),h&&(0,r.jsx)("div",{className:"text-red-500 font-medium text-base mt-4 mx-1",children:h}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"bg-indigo-500 text-white font-semibold mt-4 mx-1 py-2 px-4 cursor-pointer rounded-lg hover:bg-indigo-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Update"})]})},c=e=>{let{id:t,name:s,description:a,required:i,value:l}=e,[o,d]=(0,n.useState)(l);return(0,r.jsxs)("div",{className:"mt-4 flex flex-col mb-1",children:[(0,r.jsx)("label",{className:"text-neutral-500 font-medium text-base mx-1",htmlFor:t,children:s}),(0,r.jsx)("p",{className:"text-neutral-500 font-medium text-xs mx-1",children:a}),(0,r.jsx)("input",{type:"text",id:t,name:t,value:o,onChange:e=>d(e.target.value),required:i,className:"border border-neutral-300 text-neutral-400 font-medium bg-slate-50 max-w-3xl rounded-lg p-3 mt-3 mx-1 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 outline-none transition"})]})},u=e=>{let{id:t,name:s,description:a,required:i,value:l}=e,[o,d]=(0,n.useState)(l);return(0,r.jsxs)("div",{className:"mt-4 flex flex-col mb-1",children:[(0,r.jsx)("label",{className:"text-neutral-500 font-medium text-base mx-1",htmlFor:t,children:s}),(0,r.jsx)("p",{className:"text-neutral-500 font-medium text-xs mx-1",children:a}),(0,r.jsx)("textarea",{id:t,name:t,required:i,value:o,onChange:e=>d(e.target.value),className:"border border-neutral-300 text-neutral-400 font-medium bg-slate-50 max-w-3xl rounded-lg p-3 mt-3 mx-1 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 outline-none transition"})]})},m=e=>{let{id:t,name:s,description:a,required:i,value:l}=e,d=(0,o.oj)(),[c,u]=(0,n.useState)(l);return(0,r.jsxs)("div",{className:"mt-4 flex flex-col mb-1",children:[(0,r.jsx)("label",{className:"text-neutral-500 font-medium text-base mx-1",htmlFor:t,children:s}),(0,r.jsx)("p",{className:"text-neutral-500 font-medium text-xs mx-1",children:a}),(0,r.jsx)("select",{id:t,name:t,required:i,value:c,onChange:e=>u(e.target.value),className:"border border-neutral-300 text-neutral-400 font-medium bg-slate-50 max-w-3xl rounded-lg p-3 mt-3 mx-1 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 outline-none transition",children:Object.values(d).map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})]})}},72339:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var r=s(37876),n=s(65259),a=s(43598),i=s(89099),l=s(14232),o=s(75683),d=s(74562),c=s(16821),u=s(26478),m=s(70430);let x=()=>{let e=(0,i.useRouter)(),{id:t}=e.query,[s,x]=(0,l.useState)(!1),[f,p]=(0,l.useState)(null),[b,y]=(0,l.useState)([]),[v,j]=(0,l.useState)(!1),[w,N]=(0,l.useState)(!1),[k,q]=(0,l.useState)(!1),[S,_]=(0,l.useState)([]),[A,C]=(0,l.useState)(!1),[E,O]=(0,l.useState)({}),P=(0,l.useRef)(null),I=(0,l.useRef)(null),D=(e,t)=>{e.target.checked?_(e=>[...e,t]):_(e=>e.filter(e=>e!==t))},L=(0,l.useCallback)(async e=>{let{loader:s}=e;0===b.length&&s&&x(!0);let{data:r,error:i}=await n.A.doGet({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t,"/queries")});if(i){console.log(i),p("Something went wrong"),x(!1);return}if(r){if(0===r.queries.length){p("No questions found"),y([]),x(!1),j(!1);return}p(null),y(r.queries),j(!1),_([]),x(!1)}},[t,b.length]),Q=(0,l.useCallback)(async()=>{let{data:e,error:s}=await n.A.doGet({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t)});if(s){p("Something went wrong");return}e&&O(e.queryset.data.args),e&&"running"===e.queryset.task_status?j(!0):L({loader:!1})},[t,L]),T=async()=>{N(!0);let{data:s,error:r}=await n.A.doPost({path:"/orgs/".concat(a.A.current().id,"/aeoanalysis/tasks?queryset_id=").concat(t,"&query_ids=").concat(JSON.stringify(S)),data:{queries:S}});if(r){p(r.message),N(!1),console.log(r);return}if(s){if(!s.id){N(!1),p("Something went wrong");return}p(null),e.push("/aeo/analysis/details/?id=".concat(s.id))}};return(0,l.useEffect)(()=>{Q()},[k,Q]),(0,l.useEffect)(()=>{let e=c.A.getInstance(a.A.current().id),t=e=>{"query_task_status"===e.type&&L({loader:!1})};return e.on("message",t),()=>{e.off("message",t)}},[L]),(0,l.useEffect)(()=>{let e=e=>{var t,s;(null===(t=P.current)||void 0===t?void 0:t.contains(e.target))||(null===(s=I.current)||void 0===s?void 0:s.contains(e.target))||C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,r.jsxs)("div",{className:"bg-white  min-h-[calc(100vh-80px)]",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-2 lg:p-5 bg-white sticky top-0 z-20",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,r.jsx)("button",{className:"block cursor-pointer",onClick:()=>e.back(),children:(0,r.jsx)(o.eh5,{size:30})}),(0,r.jsx)("h2",{className:"text-sm lg:text-xl font-semibold text-[#1E2035] ",children:"List of questions"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[b.length>0&&(0,r.jsx)("button",{className:"px-2 py-1 bg-blue-600 text-white rounded cursor-pointer disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:block",onClick:T,disabled:v||w||0===S.length,children:"Analyze"}),b.length>0&&(0,r.jsx)("button",{className:"px-2 py-1 bg-red-600 text-white rounded cursor-pointer disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:0===S.length||v,onClick:()=>d.A.show("Confirm Delete",(0,r.jsx)(g,{id:t,queries:S,refetchQuery:q,setSelectedQueries:_})),children:"Delete"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{className:"p-2 rounded bg-gray-100 cursor-pointer",ref:P,onClick:()=>C(!A),children:(0,r.jsx)(u.mqA,{})}),A&&(0,r.jsxs)("div",{className:"min-w-[150px] absolute right-0 top-10 p-1 bg-white shadow-[0_0_5px_rgba(0,0,0,0.2)] rounded-lg z-50 transition-all",ref:I,children:[b.length>0&&(0,r.jsx)("button",{className:"py-1 px-2 hover:bg-gray-100 rounded cursor-pointer block w-full text-left sm:hidden",onClick:T,disabled:v||w,children:"Analyze"}),(0,r.jsx)("button",{className:"py-1 px-2 hover:bg-gray-100 rounded cursor-pointer block w-full text-left",onClick:()=>t&&d.A.show("Add Questions Manually",(0,r.jsx)(h,{id:t,refetchQuery:q})),children:"Add Manually"}),(0,r.jsx)("button",{className:"py-1 px-2 hover:bg-gray-100 rounded cursor-pointer block w-full text-left",onClick:()=>t&&e.push("/aeo/analysis?id=".concat(t)),children:"Reports"}),(0,r.jsx)("button",{className:"py-1 px-2 hover:bg-gray-100 rounded cursor-pointer block w-full text-left",onClick:()=>d.A.show("Edit Business Profile",(0,r.jsx)(m.A,{id:t,args:E,setRefetchQuery:q})),children:"Edit Business Profile"})]})]})]})]}),s&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-gray-900"})}),!s&&!v&&f&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-red-500",children:f})}),v&&(0,r.jsx)("p",{className:"text-center",children:"Generating queries..."}),!s&&!v&&b.length>0&&(0,r.jsxs)("div",{className:"sm:m-6 sm:mt-0",children:[(0,r.jsxs)("div",{className:"flex gap-3 sm:gap-4 md:gap-5 lg:gap-6 bg-gray-100 text-gray-700 font-medium py-3 px-5 sticky top-12 lg:top-18",children:[(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("input",{type:"checkbox",onChange:()=>{b.length===S.length?_([]):_(b.map(e=>e.id))},checked:S.length===b.length,className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"text-sm lg:text-base flex-1 h-full",children:"Questions"})]}),b.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-30 sm:gap-4 md:gap-5 lg-gap-6 py-4 px-5 border-b border-l border-r border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("div",{className:"text-sm lg:text-base h-full flex items-center justify-center",children:(0,r.jsx)("input",{type:"checkbox",id:e.id,name:e.id,checked:S.includes(e.id),onChange:t=>D(t,e.id),className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"text-sm lg:text-base flex-1 h-full",children:e.question})]},e.id))]})]})},h=e=>{let{id:t,refetchQuery:s}=e,[i,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(null),[m,x]=(0,l.useState)(""),h=async e=>{if(e.preventDefault(),m){if(o(!0),u(null),(await n.A.doPost({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t,"/queries"),data:{questions:m.split("\n").filter(e=>!!e.trim()).map(e=>({question:e.trim(),order:0}))}})).error){u("Something went wrong"),o(!1);return}o(!1),d.A.hide(),s(e=>!e)}};return(0,r.jsxs)("form",{onSubmit:h,children:[(0,r.jsx)("textarea",{id:"question",name:"question",placeholder:"Type your questions here. One question per line.",value:m,onChange:e=>x(e.target.value),rows:10,className:"border border-neutral-300 text-neutral-400 font-medium bg-slate-50 w-full rounded-lg p-3 mt-3 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 outline-none transition"}),c&&(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)("span",{className:"text-red-500",children:c})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-indigo-600 text-white rounded cursor-pointer",onClick:()=>d.A.hide(),children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-indigo-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:i||!m,children:"Add"})]})]})},g=e=>{let{id:t,queries:s,refetchQuery:i,setSelectedQueries:o}=e,[c,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),h=async()=>{x(null),u(!0);let e=await n.A.doPost({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t),data:{action:"delete_queries",queries:s}});if(e.error){x(e.error.message),u(!1);return}o([]),u(!1),d.A.hide(),i(e=>!e)};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center justify-start",children:(0,r.jsx)("span",{children:"Are you sure you want to delete this query?"})}),m&&(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)("span",{className:"text-red-500",children:m})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-gray-500 text-white rounded cursor-pointer",onClick:()=>d.A.hide(),children:"Cancel"}),(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-red-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:h,disabled:c,children:"Delete"})]})]})}},80498:(e,t,s)=>{"use strict";s.d(t,{_:()=>a});var r=s(32722),n=s(35712);function a(e,t,s,a){return(0,r._)(e,t),(0,n._)(s,"set"),!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,s,a),a}},85505:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/aeo/manage",function(){return s(72339)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,2517,9034,636,6593,8792],()=>t(85505)),_N_E=e.O()}]);