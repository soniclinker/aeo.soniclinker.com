(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5876],{16821:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var a=s(42874),n=s(80498),r=s(3176),i=s(65259),l=s(20318);let o=()=>r.A.apiUrl+"/connect/update";class c{static getInstance(e){return(0,a._)(c,c,d)||(0,n._)(c,c,d,new c(e)),(0,a._)(c,c,d)}setOrgId(e){this.orgId=e}on(e,t){this.listener.add(t),"not_connected"===this.status&&this.connect()}off(e){this.listener.remove(e)}setupPing(){setTimeout(()=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&(this.socket.send("{}"),this.setupPing())},3e4)}connect(){if("not_connected"!==this.status)return;this.changeStatus("connecting");let e=[],t=i.A.token();t&&e.push("access_token="+t),this.orgId&&e.push("org_id="+this.orgId);let s=e.length?"?"+e.join("&"):"";this.socket=new WebSocket(o()+s),this.socket.addEventListener("open",()=>{this.changeStatus("connected"),this.setupPing()}),this.socket.addEventListener("close",()=>{this.changeStatus("not_connected"),console.log("WebSocket closed")}),this.socket.addEventListener("message",e=>{try{let t=JSON.parse(e.data);this.listener.trigger(t)}catch(t){console.error("Invalid WebSocket message:",e.data)}})}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}disconnect(){if(this.socket)try{this.socket.close()}catch(e){console.error("Error closing WebSocket:",e)}}changeStatus(e){this.status!==e&&(this.status=e)}constructor(e){this.status="not_connected",this.socket=null,this.orgId=e,this.listener=new l.A}}var d={writable:!0,value:null};let u=c},34648:(e,t,s)=>{"use strict";s.d(t,{g:()=>a});let a=e=>{let t=(Math.floor(Date.now())-e)/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let e in s){let a=Math.floor(t/s[e]);if(a>0)return"".concat(a," ").concat(e).concat(1!==a?"s":""," ago")}return"Just now"}},58951:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Z});var a=s(37876),n=s(14232),r=s(54587),i=s.n(r),l=s(58701),o=s(43598),c=s(65259);let d=e=>{let{tabs:t,activeTab:s,handleBtnClick:n,isActiveShow:r=!0}=e;return(0,a.jsx)(a.Fragment,{children:t.map((e,t)=>(0,a.jsxs)("button",{className:"flex items-center gap-[8px] font-medium cursor-pointer p-2 hover:bg-slate-500 rounded hover:text-white ".concat(r?s===e.key?"text-indigo-600":"text-slate-500":e.color?e.color:"text-slate-500"),onClick:()=>{n(e)},children:[e.icon?e.icon:""," ",e.name]},t))})};var u=s(94344),h=s(89099),m=s(20318),x=s(82400);let p={loading:"loading",loading_more:"loading_more",loaded:"loaded",error:"error"};class g{async fetchPage(){let e=this.queryConditions.join("&"),t="".concat(e,"&offset=").concat(25*this.curPage,"&limit=").concat(25);this.curPage>0?this.state=p.loading_more:this.state=p.loading,this.currentFetchId++;let s=this.currentFetchId;this.listeners.trigger({threads:this.threads,state:this.state});let{data:a,error:n}=await c.A.doGet({path:"orgs/".concat(o.A.currentId(),"/data/threads?").concat(t)});if(s===this.currentFetchId){if(n){this.state=p.error,this.hasMorePages=!1,this.listeners.trigger({threads:this.threads,state:this.state});return}a&&a.threads?(this.threads=this.threads.concat(a.threads),this.hasMorePages=a.threads.length>=25):(this.threads=[],this.hasMorePages=!1),this.state=p.loaded,this.listeners.trigger({threads:this.threads,state:this.state})}}async fetchThreads(){this.curPage=0,this.hasMorePages=!0,this.threads=[],this.queryConditions=["category=text"],this.mentioned?this.queryConditions.push("mentioned=me"):this.assigned&&this.queryConditions.push("assigned_to=".concat(x.A.current().user_id)),this.unread?this.queryConditions.push("seen=false"):this.highPriority?this.queryConditions.push("priority=high"):this.generalPriority&&this.queryConditions.push("priority=general"),this.channel&&this.queryConditions.push("channel=".concat(this.channel)),await this.fetchPage()}addListener(e){"function"==typeof e&&this.listeners.add(e)}removeListener(e){"function"==typeof e&&this.listeners.remove(e)}setAssignedFilter(){this.assigned=!0,this.mentioned=!1,this.fetchThreads()}setMentionedFilter(){this.mentioned=!0,this.assigned=!1,this.fetchThreads()}removeFilter(){this.assigned=!1,this.mentioned=!1,this.fetchThreads()}setUnread(){this.unread=!0,this.highPriority=!1,this.generalPriority=!1,this.fetchThreads()}setHighPriority(){this.highPriority=!0,this.unread=!1,this.generalPriority=!1,this.fetchThreads()}setGeneralPriority(){this.generalPriority=!0,this.unread=!1,this.highPriority=!1,this.fetchThreads()}setAll(){this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.fetchThreads()}selectChannel(e){this.channel=e,this.fetchThreads()}removeChannel(){this.channel="",this.fetchThreads()}async addPage(){this.state===p.loaded&&this.hasMorePages&&0!==this.queryConditions.length&&0!==this.threads.length&&(this.curPage++,this.fetchPage())}async init(){this.assigned=!1,this.mentioned=!1,this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.channel="",this.threads=[],this.curPage=0,this.hasMorePages=!0,this.queryConditions=[],this.fetchThreads()}constructor(){this.assigned=!1,this.mentioned=!1,this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.channel="",this.threads=[],this.curPage=0,this.hasMorePages=!0,this.currentFetchId=0,this.listeners=new m.A,this.queryConditions=[],this.state=p.loading}}var f=s(16821);let v=[{name:"Assigned to me",key:"assignedToMe"},{name:"Mentioned",key:"mentioned"},{name:"Remove Filter",key:""}],y=e=>{let{activePage:t,isMobileView:s,setActivePage:r,messages:m,setMessages:x}=e,[p,y]=(0,n.useState)("All"),[b,j]=(0,n.useState)(""),[w,N]=(0,n.useState)([]),[k,_]=(0,n.useState)(null),[E,S]=(0,n.useState)(""),[C,A]=(0,n.useState)(!1),[D,P]=(0,n.useState)(""),F=(0,n.useRef)(new g).current,O=(0,h.useRouter)(),{thread_id:T}=O.query,M=(0,u.A)(()=>J(!1)),[I,J]=(0,n.useState)(!1),[L,R]=(0,n.useState)(v),[q,B]=(0,n.useState)(""),U={instagram:l.Rj,whatsapp:l.b_,fbpage:l.kp},Y=[{name:"WhatsApp",value:"whatsapp"},{name:"Facebook",value:"fbpage"},{name:"Instagram",value:"instagram"}],H=o.A.currentId(),X=e=>{let t=(Math.floor(Date.now())-e)/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let e in s){let a=Math.floor(t/s[e]);if(a>0)return"".concat(a," ").concat(e).concat(1!==a?"s":""," ago")}return"Just now"},z=async e=>{try{if(!e.id||e.seen)return;let{data:t,error:s}=await c.A.doPost({path:"orgs/".concat(H,"/data/threads/").concat(e.id),data:{action:"set_seen"}});s&&(P(s.message),setTimeout(()=>P(""),2e3),console.error("Error updating seen status:",s))}catch(e){console.error("Error updating seen status:",e)}},W=e=>{V(),b===e?(F.removeChannel(),j("")):(F.selectChannel(e),j(e))},G=e=>{r("Message"),_(e.id),z(e);let t=e.id;O.push({pathname:O.pathname,query:{...O.query,thread_id:t}},void 0,{shallow:!0})},V=()=>{_(null),setTimeout(()=>{O.replace({pathname:O.pathname,query:{}},void 0,{shallow:!0})},0)},Z=e=>{V(),y(e),"High Priority"===e?F.setHighPriority():"General"===e?F.setGeneralPriority():"Unread"===e?F.setUnread():F.setAll()},K=e=>{if(!e||"string"!=typeof e)return"";let t=e.match(/@\[(.*?)\]\(id:.*?\)\s?(.*)/);return t?"@".concat(t[1]," ").concat(t[2]):e},Q=e=>!!e&&Y.map(e=>e.value).includes(e),$=()=>{F.addPage()};return(0,n.useEffect)(()=>{let e=e=>{let{threads:t,state:s}=e;N(t),A("loading"===s||"loading_more"===s),P("error"===s?"Failed to load threads":"")};return F.addListener(e),F.init(),()=>{F.removeListener(e)}},[]),(0,n.useEffect)(()=>{let e=e=>{let t=e.target;t.scrollHeight-t.scrollTop<=t.clientHeight+300&&!C&&w.length>0&&$()},t=document.querySelector(".threads-container");if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[C,w.length]),(0,n.useEffect)(()=>{console.log("MessagesList messages:",m),N(e=>{var t,s;let a=[...e],n=a.find(e=>e.id===T),r=a.findIndex(e=>e.id===T),i=Object.keys(m).find(e=>e.includes("Today"));if(!i)return a;let l=null===(t=m[i])||void 0===t?void 0:t[m[i].length-1];if(n){n.last_active_at=l.time;let e=JSON.parse((null===(s=n.last_message)||void 0===s?void 0:s.data)||"{}");e.message.content=JSON.parse(l.data).message.content,n.last_message.data=JSON.stringify(e),a[r]=n}return a.sort((e,t)=>{let s=Number(e.last_active_at)||0;return(Number(t.last_active_at)||0)-s}),a})},[H,m]),(0,n.useEffect)(()=>{(T||!(w.length>0)||"Threads"!==t||!s)&&(!T&&w.length>0&&"Threads"===t||T&&w.length>0&&(_(T),r("Message")))},[T,w,O]),(0,n.useEffect)(()=>{let e=f.A.getInstance(H),t=e=>{if("thread_updated"===e.type){let t="text",s=JSON.parse(e.data.last_message),a=Object.keys(s.message);a.includes("content")?t="text":a.includes("mime_type")&&(s.message.mime_type.includes("image")?t="image":s.message.mime_type.includes("video")?t="video":s.message.mime_type.includes("application")&&(t="document")),N(s=>{var a;let n=[...s],r=n.findIndex(t=>t.id===e.thread_id);return -1===r?s:(n[r]={...n[r],last_active_at:e.data.last_active_at,data:JSON.stringify({sender_name:null===(a=e.data.data)||void 0===a?void 0:a.sender_name}),last_message:{type:t,data:e.data.last_message}},n.sort((e,t)=>{let s=Number(e.last_active_at)||0;return(Number(t.last_active_at)||0)-s}),n)})}else"thread_created"===e.type&&N(t=>{var s;if(t.find(t=>t.id===e.thread_id))return t;let a=[...t];return[{...e.data,data:JSON.stringify({sender_name:null===(s=JSON.parse(e.data.data))||void 0===s?void 0:s.sender_name})},...a]})};return e.on("message",t),()=>{e.off(t)}},[H]),(0,a.jsxs)("div",{className:"p-4 bg-white shadow-md text-xs overflow-auto relative pt-0 threads-container ".concat(s&&"Threads"===t?"w-full":"w-1/2"),children:[D&&(0,a.jsx)("div",{className:"w-[-webkit-fill-available] absolute text-white mx-[20px] z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:D}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>P(""),children:"x"})]})}),(0,a.jsxs)("div",{className:"sticky top-0 bg-white z-6 pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"font-bold text-black text-sm flex-none",children:"Recent Messages"}),(0,a.jsxs)("div",{className:"flex justify-end items-center gap-x-2 relative text-[#64748A] w-full",children:[q&&L.filter(e=>e.key==q)[0].name,(0,a.jsx)(i(),{src:l.pb,width:24,height:24,alt:"Filter",onClick:()=>J(!I),className:"mr-2 cursor-pointer"}),I&&(0,a.jsx)("nav",{ref:M,className:"flex w-max flex-col absolute top-[42px] z-50 rounded-sm p-2 border-[0.4px] border-[#CAD4E0] bg-white shadow-[box-shadow: 0px 8px 10px -6px rgba(0, 0, 0, 0.10), 0px 20px 25px -5px rgba(0, 0, 0, 0.10)]",children:(0,a.jsx)(d,{tabs:L,activeTab:q,handleBtnClick:e=>{B(e.key),J(!1),V(),"assignedToMe"===e.key?F.setAssignedFilter():"mentioned"===e.key?F.setMentionedFilter():F.removeFilter(),S(e.key)},isActiveShow:!1})})]})]}),(0,a.jsx)("div",{className:"flex items-center mt-[16px] gap-[10px] mb-[15px] overflow-auto flex-wrap",children:[{name:"All",value:null},{name:"High Priority",color:"#F33F5E",value:0},{name:"General",color:"#2563EA",value:1},{name:"Unread",color:"#16A24A"}].map(e=>(0,a.jsxs)("div",{className:"flex text-xs font-normal items-center justify-center p-[12px] gap-[6px] w-fit min-w-[77px] h-[25px] font-normal rounded-sm cursor-pointer",onClick:()=>Z(e.name),style:{backgroundColor:p===e.name?"#EDF1FE":"transparent",color:p===e.name?"#4F46E4":"#A2A2A2"},children:[e.color&&(0,a.jsx)("span",{className:"w-[4px] h-[4px] rounded-full ",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"whitespace-nowrap ",children:e.name})]},e.name))}),(0,a.jsx)("div",{className:"w-full h-px ",style:{backgroundColor:"#D3D3D3"}}),(0,a.jsx)("div",{className:"flex gap-[9px] items-center overflow-x-auto scrollbar-none h-[60px] flex-wrap",children:Y.map((e,t)=>(0,a.jsx)("div",{className:"px-3 py-1 w-fit rounded-2xl cursor-pointer ".concat(b===e.value?"bg-indigo-50 text-indigo-600":"bg-slate-100 text-slate-500"),onClick:()=>W(e.value),children:e.name},"".concat(e.value+t)))})]}),(0,a.jsx)("div",{className:"bg-[#F7F9FB]",children:C&&0===w.length?(0,a.jsx)("div",{className:"text-center py-4",children:"Loading threads..."}):(0,a.jsxs)(a.Fragment,{children:[w.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"text-[#737373] flex gap-[13px] items-center h-20 px-6 py-4 cursor-pointer ".concat(k===e.id?"bg-indigo-50":""),onClick:()=>G(e),children:[(0,a.jsxs)("div",{className:"relative w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer min-w-[40px] min-h-[40px]",children:[(0,a.jsx)(i(),{src:l.ff,height:24,width:24,alt:"User-icon"}),Q(e.channel)&&(0,a.jsx)("span",{className:"absolute bottom-[0px] left-[0px] bg-white rounded-2xl",children:(0,a.jsx)(i(),{src:U[null==e?void 0:e.channel],height:16,width:16,alt:"channel"})})]}),(0,a.jsxs)("div",{className:"flex flex-col overflow-hidden ",children:[(0,a.jsx)("div",{className:"text-black font-normal",children:(null===(s=JSON.parse(e.data))||void 0===s?void 0:s.sender_name)||""}),(0,a.jsx)("div",{className:"truncate w-full",children:(()=>{var t,s,a,n;switch(null==e?void 0:null===(t=e.last_message)||void 0===t?void 0:t.type){case"text":return K((null===(a=JSON.parse((null==e?void 0:null===(n=e.last_message)||void 0===n?void 0:n.data)||"{}"))||void 0===a?void 0:null===(s=a.message)||void 0===s?void 0:s.content)||"");case"video":return"Video";case"image":return"Image";case"document":return"Document";default:return""}})()})]}),(0,a.jsx)("div",{className:"ml-auto h-[44px] flex justify-start items-start",children:(0,a.jsxs)("div",{className:"flex items-center gap-[12px]",children:[(0,a.jsx)("span",{className:"min-w-[72px] text-neutral-500 text-xs font-normal",children:X(Number(e.last_active_at))}),(0,a.jsx)("div",{className:"w-[8px] h-[8px] rounded-full ".concat(e.priority?"bg-[#2563EA]":"bg-[#F33F5E]"),children:" "})]})})]},"".concat((null==e?void 0:e.id)+t))}),C&&w.length>0&&(0,a.jsx)("div",{className:"text-center py-4",children:"Loading more..."})]})}),0===w.length&&!C&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:"No messages available."})]})};var b=s(77929),j=s.n(b),w=s(26478),N=s(7972),k=s(45732),_=s(74562),E=s(24814);let S={control:{backgroundColor:"#fff",fontSize:14,fontWeight:"normal"},"&multiLine":{control:{fontFamily:"monospace",minHeight:80},highlighter:{padding:9,border:"1px solid transparent"},input:{padding:9,border:"1px solid silver"}},"&singleLine":{display:"inline-block",width:180,highlighter:{padding:1,border:"2px inset transparent"},input:{padding:1,border:"2px inset"}},suggestions:{list:{backgroundColor:"white",border:"1px solid rgba(0,0,0,0.15)",fontSize:14},item:{padding:"5px 15px",borderBottom:"1px solid rgba(0,0,0,0.15)","&focused":{backgroundColor:"#cee4e5"}}}},C=e=>{let{onClose:t,thread:s}=e,[r,i]=(0,n.useState)(""),[l,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(""),m=o.A.currentId(),x=(0,n.useCallback)(async()=>{try{let{data:e,error:t}=await c.A.doGet({path:"/orgs/".concat(m,"/users")});if(t){h(t.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching users:",t);return}d((null==e?void 0:e.users)||[])}catch(e){console.error("Error fetching users:",e)}},[m]),p=async(e,a,n)=>{try{if(!s.id)return;let{data:r,error:i}=await c.A.doPost({path:"orgs/".concat(m,"/data/threads/").concat(s.id),data:{action:"comment",message:e||"",assign_to:a||null,mentions:n||null}});if(i){h(i.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",i);return}t(e)}catch(e){console.error("Error fetching invited users:",e)}},g=e=>{let t;let s=/@\[(.*?)\]\(id:(.*?)\)/g,a=[];for(;null!==(t=s.exec(e));)a.push({name:t[1],id:t[2]});return a},f=async()=>{let e=g(r).map(e=>e.id);if(r&&r.length>0)try{await p(r,e[0]||null,e)}catch(e){console.error("Error assigning user:",e)}};return(0,n.useEffect)(()=>{x()},[x]),(0,a.jsxs)("div",{className:"flex flex-col gap-[16px]",children:[u&&(0,a.jsx)("div",{className:"w-lg lg:w-xl absolute text-white z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:u}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>h(""),children:"x"})]})}),(0,a.jsx)("div",{className:"h-[0.6px] bg-[#E1E7EF]"}),(0,a.jsx)("div",{className:"text-[#64748A]",children:"Assign a particular conversation to a particular user. Add the task too. Tasks are visible to you and the admin only."}),(0,a.jsx)("div",{className:"relative w-full max-w-lg p-4",children:(0,a.jsx)(E.G,{value:r,onChange:e=>i(e.target.value),style:S,placeholder:"Mention people using '@'",a11ySuggestionsListLabel:"Suggested mentions",children:(0,a.jsx)(E.P,{markup:"@[__display__](id:__id__)",trigger:"@",data:l.map(e=>({id:e.id,display:e.name})),displayTransform:(e,t)=>"@".concat(t),renderSuggestion:(e,t,s,n,r)=>(0,a.jsx)("div",{className:"user ".concat(r?"focused":""),children:s}),style:{backgroundColor:"#cee4e5"}})})}),(0,a.jsxs)("div",{className:"flex justify-end gap-[8px]",children:[(0,a.jsx)("button",{className:"text-[14px] font-semibold py-[10px] px-[14px] text-[#334155] bg-[#F0F4F8] rounded-sm",onClick:()=>t(""),children:"Cancel"}),(0,a.jsx)("button",{className:"text-[14px] font-semibold py-[10px] px-[14px] text-white bg-[#4F46E4] rounded-sm",onClick:f,children:"Assign"})]})]})};var A=s(13216),D=s(75683),P=s(68214),F=s(18847),O=s.n(F);let T=e=>{let{template:t,templateName:s,getLatestInputs:r}=e,l=(0,n.useRef)(""),o=JSON.stringify(t),c=l.current!==o,d=(0,n.useMemo)(()=>t.find(e=>"BODY"===e.type),[t]),u=(0,n.useMemo)(()=>{var e;return(null==d?void 0:null===(e=d.example)||void 0===e?void 0:e.body_text_named_params)||[]},[d]),h=(0,n.useMemo)(()=>{var e,t;return(null==d?void 0:null===(t=d.example)||void 0===t?void 0:null===(e=t.body_text)||void 0===e?void 0:e[0])||[]},[d]),m=(0,n.useMemo)(()=>{let e=[];return(null==d?void 0:d.text)&&[...d.text.matchAll(/{{(\d+)}}/g)].forEach(t=>{let s=t[1];e.includes(s)||e.push(s)}),e},[d]),x=(0,n.useMemo)(()=>t.find(e=>"HEADER"===e.type),[t]),p=(0,n.useMemo)(()=>{var e;return(null==x?void 0:null===(e=x.example)||void 0===e?void 0:e.header_text_named_params)||[]},[x]),g=(0,n.useMemo)(()=>{var e,t;return(null==x?void 0:null===(t=x.example)||void 0===t?void 0:null===(e=t.header_text)||void 0===e?void 0:e[0])||[]},[x]),f=(0,n.useMemo)(()=>{let e=[];return(null==x?void 0:x.text)&&[...x.text.matchAll(/{{(\d+)}}/g)].forEach(t=>{let s=t[1];e.includes(s)||e.push(s)}),e},[x]),v=(0,n.useMemo)(()=>u.reduce((e,t)=>(e[t.param_name]=t.example||"",e),{}),[u]),y=(0,n.useMemo)(()=>p.reduce((e,t)=>(e[t.param_name]=t.example||"",e),{}),[p]),b=(0,n.useMemo)(()=>{let e={};return m.forEach((t,s)=>{e[t]=h[s]||""}),e},[m,h]),j=(0,n.useMemo)(()=>{let e={};return f.forEach((t,s)=>{e[t]=g[s]||""}),e},[f,g]),[w,N]=(0,n.useState)(y),[k,_]=(0,n.useState)(v),[E,S]=(0,n.useState)(j),[C,A]=(0,n.useState)(b),D=(e,t)=>{_(s=>{let a={...s,[e]:t};return r(a,"BODY"),a})},P=(e,t)=>{N(s=>{let a={...s,[e]:t};return r(a,"HEADER"),a})},F=(e,t)=>{A(s=>{let a={...s,[e]:t};return r(a,"BODY-INDEX"),a})},O=(e,t)=>{S(s=>{let a={...s,[e]:t};return r(a,"HEADER-INDEX"),a})};(0,n.useEffect)(()=>{c&&(N(y),_(v),S(j),A(b),r(v,"BODY"),r(y,"HEADER"),r(b,"BODY-INDEX"),r(j,"HEADER-INDEX"),l.current=o)},[o,c,v,y,b,j,r]);let T=e=>e.text.replace(/{{(.*?)}}/g,(e,t)=>{let s=t.trim();return/^\d+$/.test(s)?C[s]||"{{".concat(s,"}}"):k[s]||"{{".concat(s,"}}")}),M=e=>{var t,s,n;if("IMAGE"===e.format){let t=null==e?void 0:null===(s=e.example)||void 0===s?void 0:s.header_handle;if(t&&t.length>0)return t.map((e,t)=>(0,a.jsx)(i(),{src:e,alt:"Template Image",width:100,height:120,className:"w-full h-[120px]"},t))}if("VIDEO"===e.format){let t=null==e?void 0:null===(n=e.example)||void 0===n?void 0:n.header_handle;if(t&&t.length>0)return t.map((e,t)=>(0,a.jsxs)("video",{controls:!0,className:"w-full h-[120px]",children:[(0,a.jsx)("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]},"".concat(t,"-").concat(e)))}return null===(t=e.text)||void 0===t?void 0:t.replace(/{{(.*?)}}/g,(e,t)=>{let s=t.trim();return/^\d+$/.test(s)?E[s]||"{{".concat(s,"}}"):w[s]||"{{".concat(s,"}}")})};return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-[20px]",children:[(u.length>0||p.length>0||m.length>0||f.length>0)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Fill Template Values:"}),(p.length>0||f.length>0)&&(0,a.jsx)("p",{className:"text-md font-semibold mb-[0px]",children:"Header Inputs:"}),p.map(e=>{let{param_name:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"font-medium capitalize",children:t}),(0,a.jsx)("input",{type:"text",value:w[t]||"",onChange:e=>P(t,e.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter ".concat(t)})]},t)}),f.map(e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("label",{className:"font-medium",children:["Parameter ",e]}),(0,a.jsx)("input",{type:"text",value:E[e]||"",onChange:t=>O(e,t.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter value for parameter ".concat(e)})]},"header-".concat(e))),(u.length>0||m.length>0)&&(0,a.jsx)("p",{className:"text-md font-semibold mb-[0px]",children:"Body Inputs:"}),u.map(e=>{let{param_name:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"font-medium capitalize",children:t}),(0,a.jsx)("input",{type:"text",value:k[t]||"",onChange:e=>D(t,e.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter ".concat(t)})]},t)}),m.map(e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("label",{className:"font-medium",children:["Parameter ",e]}),(0,a.jsx)("input",{type:"text",value:C[e]||"",onChange:t=>F(e,t.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter value for parameter ".concat(e)})]},"body-".concat(e)))]}),(0,a.jsx)("div",{className:"font-[Urbanist] font-semibold p-4 grow bg-[#EDF1FE] border-[0.4px] border-[#4F46E4] rounded-md shadow text-black font-sans space-y-4",children:t.map((e,t)=>{switch(e.type){case"HEADER":return(0,a.jsx)("h2",{className:"text-lg font-bold",children:M(e)},t);case"BODY":return(0,a.jsx)("p",{className:"whitespace-pre-line",children:T(e)},t);case"FOOTER":return(0,a.jsx)("div",{className:"text-sm text-gray-700",children:e.text},t);default:return null}})})]})},M=e=>{let{onClose:t,thread:s}=e,[r,i]=(0,n.useState)([]),[l,d]=(0,n.useState)({}),[u,h]=(0,n.useState)(""),m=o.A.currentId(),[x,p]=(0,n.useState)({}),[g,f]=(0,n.useState)({}),[v,y]=(0,n.useState)({}),[b,j]=(0,n.useState)({}),w=async()=>{let{data:e,error:t}=await c.A.doGet({path:"orgs/".concat(m,"/whatsapp/templates")});if(t){h(t.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",t);return}i((null==e?void 0:e.templates)||[])},N=async(e,a,n,r)=>{let{data:i,error:o}=await c.A.doPost({path:"orgs/".concat(m,"/data/threads/").concat(s.id),data:{action:"send_message",template_name:l.name,body_inputs:e,header_inputs:a,body_index:n,header_index:r}});if(o){h(o.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",o);return}t({msg:function(e,t){let s=e.components||[],a=t.body_inputs||{},n=t.body_index||{},r=t.header_inputs||{},i=t.header_index||{},l="";for(let e of s){var o,c,d,u,h,m,x;if("HEADER"===e.type&&"TEXT"===e.format){let t=e.text;if(Object.keys(e.example||{}).includes("header_text_named_params")){let s=null===(c=e.example)||void 0===c?void 0:null===(o=c.header_text_named_params)||void 0===o?void 0:o.map(e=>e.param_name);null==s||s.forEach(e=>{t=t.replace("{{".concat(e,"}}"),r[e])}),l+=t+"\n"}else((null===(u=e.example)||void 0===u?void 0:null===(d=u.header_text)||void 0===d?void 0:d.map((e,t)=>t+1))||[]).forEach(e=>{t=t.replace("{{".concat(e,"}}"),i[e])}),l+=t+"\n"}else if("BODY"===e.type){let t=e.text;if(Object.keys(e.example||{}).includes("body_text_named_params")){let s=null===(m=e.example)||void 0===m?void 0:null===(h=m.body_text_named_params)||void 0===h?void 0:h.map(e=>e.param_name);null==s||s.forEach(e=>{t=t.replace("{{".concat(e,"}}"),a[e])}),l+=t+"\n"}else((null===(x=e.example)||void 0===x?void 0:x.body_text[0].map((e,t)=>t+1))||[]).forEach(e=>{t=t.replace("{{".concat(e,"}}"),n[e])}),l+=t+"\n"}else"FOOTER"===e.type&&(l+=e.text)}return l}(l,{body_inputs:e,body_index:n,header_inputs:a,header_index:r}),id:i.message_id})};return(0,n.useEffect)(()=>{w()},[]),(0,a.jsxs)("div",{className:"flex flex-col gap-[14px] w-full",children:[u&&(0,a.jsx)("div",{className:"w-lg lg:w-xl absolute text-white z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:u}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>h(""),children:"x"})]})}),(0,a.jsxs)("div",{className:" flex flex-col gap-[20px]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-[4px] pt-2 relative",children:[(0,a.jsx)("label",{children:"Select Template:"}),(0,a.jsxs)("select",{id:"businesses",className:"appearance-none w-full max-w-xs px-4 py-2 bg-[#F7F9FB] text-gray-700 rounded-lg border-[0.4px] border-[#CAD4E0] shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer",onChange:e=>{let t=e.target.value;if(0===r.length)return;d({});let s=r.find(e=>{let{id:s}=e;return s===t});y({}),j({}),p({}),f({}),d(s)},children:[!(null==l?void 0:l.id)&&(0,a.jsx)("option",{value:"",children:"Select Your Business"}),r.map(e=>{let{id:t,name:s}=e;return(0,a.jsx)("option",{value:t,children:s},t)})]}),(0,a.jsx)("div",{className:"top-[10px] pointer-events-none absolute inset-y-0 right-3 flex items-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 12a1 1 0 01-.7-.3l-4-4a1 1 0 111.4-1.4L10 9.6l3.3-3.3a1 1 0 011.4 1.4l-4 4a1 1 0 01-.7.3z",clipRule:"evenodd"})})})]}),(0,a.jsx)("div",{children:l&&Object.keys(l).length>0&&(0,a.jsx)(T,{template:l.components||[],templateName:l.name||"",getLatestInputs:(e,t)=>{switch(t){case"BODY":p(e);break;case"HEADER":f(e);break;case"BODY-INDEX":y(e);break;case"HEADER-INDEX":j(e)}}})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] border-1 border-[#CAD4E0] text-[#000] bg-[#F0F4F8] rounded font-semibold cursor-pointer",onClick:async()=>{t({msg:"",id:""})},children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] text-white items-center gap-[8px] p-[4px] rounded font-semibold ".concat(void 0===l.id?"bg-[#93A2B7] cursor-not-allowed":"bg-[#4F46E4] cursor-pointer"),onClick:async()=>{N(x,g,v,b)},disabled:void 0===l.id,children:"Send"})]})]})},I=e=>{let{onClose:t,onConFirm:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-[14px]",children:[(0,a.jsx)("div",{className:"flex justify-start",children:"Are you sure you want to block the User?"}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] border-1 text-[#000] bg-[#F0F4F8] rounded font-semibold cursor-pointer",onClick:async()=>t(),children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] bg-[#4F46E4] rounded text-white font-semibold cursor-pointer",onClick:()=>s(),children:"Block"})]})]})},J=e=>{let{onClose:t,onConFirm:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-[14px]",children:[(0,a.jsx)("div",{className:"flex justify-start",children:"Are you sure you want to clear the chat?"}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] border-1 p-[4 px] bg-[#F0F4F8] rounded text-black font-semibold cursor-pointer",onClick:async()=>t(),children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] bg-[#4F46E4] rounded text-white font-semibold cursor-pointer",onClick:async()=>s(),children:"Clear"})]})]})};var L=s(21976);let R=e=>{let{contactBlocked:t,isAiEnabled:s,message:n,isMobileView:r,isMessageDropDownOPen:o,thread:c,setIsMessageDropDownOPen:d,handleTemplateForMessage:u,sendMessageHandler:h,updateBlockStatus:m,setIsAiEnabled:x,setIsAi:p,setMessage:g}=e;return(0,a.jsxs)("div",{className:"w-auto text-black text-[12px] m-2 relative",children:[!t&&(0,a.jsx)("div",{className:"absolute top-[4px] left-[20px]",children:(0,a.jsx)("div",{className:"flex items-center",children:t?"":s?(0,a.jsxs)("div",{children:["AI is enabled."," ",(0,a.jsx)("a",{className:"cursor-pointer underline font-semibold",onClick:()=>{x(!1),p(!1)},children:"Click here to disable"})]}):(0,a.jsxs)("div",{children:["AI is disabled."," ",(0,a.jsx)("a",{className:"cursor-pointer underline font-semibold",onClick:()=>{x(!0),p(!0)},children:"Click here to enable"})]})})}),(0,a.jsxs)("div",{className:"w-full flex items-center gap-[10px] p-[18px] pb-[8px] border border-[#CAD4E0] rounded-lg ".concat(t?"blur-[100px]":""),children:[(0,a.jsxs)("div",{className:"grow relative",children:[(0,a.jsx)("textarea",{className:"w-full mt-1 p-[11px] pr-[36px] scrollbar-hidden h-[44px] rounded-lg outline-none resize-none border-[0.5px] border-solid border-slate-300",placeholder:s?"Disable AI and send reply":"Enter the message",value:n,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h(0))}}),"whatsapp"==c.channel&&(0,a.jsx)("div",{className:"absolute top-[14px] right-[12px] text-[24px] bg-white text-slate-400 cursor-pointer",onClick:e=>{e.stopPropagation(),u()},children:(0,a.jsx)(L.YVP,{})})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("button",{className:"flex items-center gap-[8px] py-[10px] pl-[10px] pr-[10px] bg-[#4F46E4] rounded-full text-white font-semibold cursor-pointer relative",onClick:()=>h(0),children:[(0,a.jsx)("span",{children:"Send"}),(0,a.jsx)(i(),{src:l.tN,height:16,width:16,alt:"send-icon"})]})})]}),t&&(0,a.jsx)("div",{className:"flex justify-center w-full text-[16px] absolute top-[30px]",children:(0,a.jsx)("div",{onClick:async()=>m(!1),className:"bg-[#F0F4F8] px-2 py-1 rounded cursor-pointer",children:"You blocked this Contact. Tap to Unblock"})})]})};var q=s(88564);let B=e=>{let{src:t,alt:s="Image",className:r=""}=e,[l,o]=(0,n.useState)(!1),c=()=>{o(!l)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{src:t,alt:s,width:150,height:200,className:"max-w-full transition-transform duration-200 ease-in-out hover:scale-[1.02] cursor-pointer ".concat(r),onClick:c,style:{maxWidth:"400px",maxHeight:"200px"}}),l&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-85 flex items-center justify-center z-50 animate-fadeIn",onClick:c,onKeyDown:e=>{"Escape"===e.key&&l&&o(!1)},tabIndex:0,children:(0,a.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[(0,a.jsx)("button",{className:"absolute -top-10 -right-10 bg-transparent border-none text-white text-4xl cursor-pointer z-[51]",onClick:e=>{e.stopPropagation(),c()},children:"\xd7"}),(0,a.jsx)(i(),{src:t,alt:s,width:500,height:400,className:"max-w-full max-h-[90vh] object-contain shadow-lg"})]})})]})};var U=s(3176);let Y=e=>{let{orgId:t,mediaId:s,thread_id:r,content_type:i,filename:l}=e,[o,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),m=c.A.token(),x=U.A.apiUrl;return u?(0,a.jsx)("div",{children:"Loading media..."}):i.startsWith("image/")?(0,a.jsx)(B,{src:"".concat(x,"/orgs/").concat(t,"/whatsapp/media/").concat(s,"?access_token=").concat(m,"&thread_id=").concat(r),alt:"WhatsApp Media",className:"rounded-lg border border-gray-200"}):i.startsWith("video/")?(0,a.jsxs)("video",{controls:!0,style:{width:"300px",height:"200px"},children:[(0,a.jsx)("source",{src:"".concat(x,"/orgs/").concat(t,"/whatsapp/media/").concat(s,"?access_token=").concat(m,"&thread_id=").concat(r),type:null==o?void 0:o.contentType}),"Your browser does not support the video tag."]}):(0,a.jsx)("a",{href:"".concat(x,"/orgs/").concat(t,"/whatsapp/media/").concat(s,"?access_token=").concat(m,"&thread_id=").concat(r),download:l||"Document",children:(0,a.jsxs)("div",{className:"flex items-center gap-[8px] border-[0.5px] border-[#cad4e0] rounded-[8px] p-[8px]",children:[(0,a.jsx)(q.WFg,{className:"h-[40px] w-[40px] text-slate-400"}),(0,a.jsx)("div",{children:"Download Document"})]})})},H=O()(()=>Promise.all([s.e(9923),s.e(3845),s.e(2736)]).then(s.bind(s,22736)),{loadableGenerated:{webpack:()=>[22736]},ssr:!1}),X=[{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(N.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(N.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",key:"clear-chat",icon:(0,a.jsx)(P.c8Z,{})}],z=e=>{var t;let{activePage:s,isMobileView:r,setActivePage:m,addMessageToList:x,thread:p,setThread:g,messages:v,setMessages:y,messagesContainerRef:b}=e,E=(0,h.useRouter)(),{thread_id:S}=E.query,[F,O]=(0,n.useState)(!1),[T,L]=(0,n.useState)(""),[q,B]=(0,n.useState)(!1),[U,z]=(0,n.useState)(!1),[W,G]=(0,n.useState)(""),[V,Z]=(0,n.useState)(!0),[K,Q]=(0,n.useState)(!0),[$,ee]=(0,n.useState)(0),et=(0,n.useRef)(!1),es=[{name:"WhatsApp",value:"whatsapp"},{name:"Facebook",value:"fbpage"},{name:"Instagram",value:"instagram"}],ea=(0,u.A)(()=>B(!1)),[en,er]=(0,n.useState)(X),ei=o.A.currentId(),el=(0,n.useRef)(!1),eo={instagram:l.Rj,whatsapp:l.b_,fbpage:l.kp},ec=async()=>{if(!S){g({}),Q(!1);return}let{data:e,error:t}=await c.A.doGet({path:"orgs/".concat(ei,"/data/threads/").concat(S)});if(t){G(t.message),(0,A.setTimeout)(()=>{G("")},2e3),console.error("Error fetching invited users:",t);return}e&&e.thread&&(g(e.thread),z("blocked"===e.thread.mode),Z("auto"===e.thread.mode||!e.thread.mode))},ed=async e=>{if(!S||et.current)return;et.current=!0;let{data:t,error:s}=await c.A.doGet({path:"orgs/".concat(ei,"/data/threads/").concat(S,"/messages?limit=25&offset=").concat(25*e)});if(s){G(s.message),(0,A.setTimeout)(()=>{G("")},2e3),console.error("Error fetching invited users:",s);return}t&&t.messages&&0!==t.messages.length&&(t.messages=t.messages.filter(e=>"assistant"===JSON.parse(e.data).message.role||"user"===JSON.parse(e.data).message.role)),t&&t.messages&&ev(t.messages.toReversed()),Q(0!==t.messages.length),(0,A.setTimeout)(()=>{el.current=!0,b&&b.current&&0==e&&(b.current.scrollTop=b.current.scrollHeight)},10),et.current=!1},eu=async e=>{Z(!e),await eh({action:"set_mode",mode:e?"blocked":"auto"}),e?(er([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(N.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(N.Yh2,{})},{name:"Unblock Contact",key:"Unblock-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),z(!0)):(er([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(N.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(N.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),z(!1))},eh=async e=>{try{if(!p.id)return;let{data:t,error:s}=await c.A.doPost({path:"orgs/".concat(ei,"/data/threads/").concat(p.id),data:e});if(s){G(s.message),(0,A.setTimeout)(()=>{G("")},2e3),console.error("Error fetching invited users:",s);return}"send_message"===e.action&&(Z(!1),x({msg:e.message,id:t.message_id},"text")),"delete_messages"===e.action&&(y({}),ee(0))}catch(e){G(e.message),console.error("Error fetching :",e)}},em=async e=>{T&&(await eh({action:"send_message",message:T}),L(""))},ex=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});function ep(e){let t;let s=new Date(e),a=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=Math.floor((new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()-n.getTime())/864e5);if(0===r)t="Today";else if(1===r)t="Yesterday";else if(r<=6)t="".concat(r," days ago");else if(r<=29){let e=Math.floor(r/7);t="".concat(e," week ago")}else if(r<=365){let e=Math.floor(r/30);t="".concat(e," month ago")}else{let e=Math.floor(r/365);t="".concat(e," year ago")}let i=s.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),"".concat(t,", ").concat(i)}let eg=async e=>{var t,s;B(!1),"assign-user"===e.key?_.A.show("Assign User",(0,a.jsx)(C,{onClose:e=>{e&&x({msg:e,id:j().uuid()},"comment"),_.A.hide()},thread:p})):"block-contact"===e.key?_.A.show("Block ".concat(null===(t=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===t?void 0:t.sender_name,"?"),(0,a.jsx)(I,{onClose:()=>{_.A.hide()},onConFirm:async()=>{await eu(!0),_.A.hide()}})):"Unblock-contact"===e.key?await eu(!1):"profile"===e.key?(E.push({pathname:"/messages",query:{profile:"true",thread_id:E.query.thread_id}},void 0,{shallow:!0}),m("Profile")):"clear-chat"===e.key&&_.A.show("Clear Chat with ".concat(null===(s=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===s?void 0:s.sender_name,"?"),(0,a.jsx)(J,{onClose:()=>{_.A.hide()},onConFirm:async()=>{await eh({action:"delete_messages"}),_.A.hide()}}))},ef=(0,n.useCallback)(e=>{if(!e)return"";let t=e.match(/@\[(.*?)\]\(id:.*?\)\s?(.*)/);return t?"@".concat(t[1]," ").concat(t[2]):e},[]),ev=e=>{let t={};e.forEach(e=>{let s=ep(Number(e.time));t[s]||(t[s]=[]),t[s].push(e)}),y(e=>{let s={...e},a=Object.keys(s);return Object.keys(t).forEach(e=>{a.includes(e)&&(t[e].toReversed().forEach(t=>{s[e].unshift(t)}),delete t[e])}),{...t,...s}})},ey=e=>{e.stopPropagation(),m("Threads"),E.replace({pathname:E.pathname,query:{}},void 0,{shallow:!0})};return(0,n.useEffect)(()=>{let e=e=>{0===e.target.scrollTop&&!et.current&&Object.keys(v).length>0&&K&&ee(e=>e+1)},t=document.querySelector(".message-container");if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[et,Object.keys(v).length]),(0,n.useEffect)(()=>{K&&ed($)},[$]),(0,n.useEffect)(()=>{"blocked"==p.mode?(er([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(N.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(N.Yh2,{})},{name:"Unblock Contact",key:"Unblock-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),z(!0)):(er([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(N.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(N.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),z(!1)),K&&ed($)},[ei,$]),(0,n.useEffect)(()=>{y({}),el.current=!1,Q(!0),ee(()=>(ec(),ed(0),0))},[S]),(0,n.useEffect)(()=>{let e=f.A.getInstance(ei),t=e=>{"message_created"===e.type?S===e.thread_id&&x({msg:"",id:""},"text",e.data):"message_status_updated"===e.type&&S===e.thread_id&&y(t=>{let s={...t};for(let t of Object.keys(s)){let a=s[t].findIndex(t=>t.id===e.data.id);if(-1!==a){"read"!==s[t][a].status&&(s[t][a].status=e.data.status);break}}return s})};return e.on("message",t),()=>{e.off(t)}},[ei,S]),S?(0,a.jsxs)("div",{className:"text-black bg-white shadow-lg flex flex-col ".concat(r&&"Message"===s?"w-full":"w-1/2"),children:[W&&(0,a.jsx)("div",{className:"w-[-webkit-fill-available] absolute text-white mx-[20px] z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:W}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>G(""),children:"x"})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-[7px] pb-[7px] pl-[18px] pr-[18px] border-b border-[#CAD4E0] h-[60px]",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center",onClick:()=>{p.id&&(E.push({pathname:"/messages",query:{profile:"true",thread_id:E.query.thread_id}},void 0,{shallow:!0}),m("Profile"))},children:[r&&"Message"===s&&(0,a.jsx)("div",{onClick:e=>ey(e),className:"cursor-pointer",children:(0,a.jsx)(D.K9R,{size:"24px",className:"mr-2"})}),(0,a.jsxs)("div",{className:"relative w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer",children:[(0,a.jsx)(i(),{src:l.ff,height:24,width:24,alt:"User-icon"}),(e=>!!e&&es.map(e=>e.value).includes(e))(p.channel)&&(0,a.jsx)("span",{className:"absolute bottom-[0px] left-[0px] bg-white rounded-2xl",children:p.channel&&(0,a.jsx)(i(),{src:eo[null==p?void 0:p.channel],height:16,width:16,alt:"channel"})})]}),(0,a.jsxs)("div",{className:"text-[14px] ml-[10px]",children:[(0,a.jsx)("div",{children:null===(t=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===t?void 0:t.sender_name}),(0,a.jsx)("div",{children:p.from})]})]}),(0,a.jsx)("div",{className:"flex justify-center items-center gap-[23px]",children:(0,a.jsx)("div",{className:"cursor-pointer",children:(0,a.jsxs)("div",{className:" flex flex-col gap-3 justify-end items-end relative",children:[(0,a.jsx)(w.mqA,{className:"text-2xl text-slate-500 ".concat(p.id?"":"opacity-50 cursor-not-allowed"),onClick:()=>{p.id&&B(!q)}}),q&&(0,a.jsx)("nav",{ref:ea,className:"flex w-max flex-col absolute top-[42px] z-50 rounded-sm p-2  border-[0.4px]  border-[#CAD4E0] bg-white shadow-[box-shadow: 0px 8px 10px -6px rgba(0, 0, 0, 0.10), 0px 20px 25px -5px rgba(0, 0, 0, 0.10)]",children:(0,a.jsx)(d,{tabs:en,handleBtnClick:eg,isActiveShow:!1})})]})})})]}),(0,a.jsxs)("div",{className:"w-auto flex-1 p-4 overflow-y-auto bg-white text-[14px] overflow-auto grow message-container",ref:b,children:[K&&(0,a.jsxs)("div",{className:"text-center py-4",children:[0==Object.keys(v).length&&"Loading threads...",et.current&&0!==Object.keys(v).length&&"Loading more messages..."]}),Object.keys(v).map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex justify-center my-[10px]",style:{fontWeight:"bold",margin:"10px 0"},children:(0,a.jsx)("span",{className:"font-medium rounded bg-[#EDF1FE] py-[2px] px-[10px]",children:e})}),(0,a.jsx)("div",{className:"space-y-3",children:v[e].map(e=>(0,a.jsx)("div",{className:"flex gap-[10px] w-full ".concat("user"===e.by?"flex-row":" flex-row-reverse"),children:(0,a.jsx)("div",{className:"flex w-11/12 ".concat("user"===e.by?"justify-start":"justify-end"),children:(()=>{var t,s,n,r,o,c,d,u,h,m,x,p,g,f,v,y,b,j,w,N,k;switch(e.type){case"comment":return(0,a.jsxs)("div",{className:"rounded-[4px] border-[0.3px] border-[#DA2777] p-[12px] bg-[#FBE6F2]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:JSON.parse(e.data).by.name||JSON.parse(e.data).by.email})," ","left a task for you"," "]}),(0,a.jsxs)("div",{className:"font-medium",children:['"',ef(JSON.parse(e.data).message.content),'"']}),(0,a.jsx)("div",{className:"text-[#64748A]",children:ep(Number(e.time))})]});case"text":return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"flex my-1 ".concat("user"===e.by?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"inline-block break-words text-sm font-medium leading-snug max-w-xs relative\n                                ".concat("user"===e.by?"bg-indigo-600 text-white px-4 pt-2 pb-6 rounded-r-xl rounded-tl-xl":"bg-gray-200 text-black px-4 pt-2 pb-6 rounded-l-xl rounded-tr-xl","\n                              "),children:[null===(n=JSON.parse(e.data||"{}"))||void 0===n?void 0:null===(s=n.message)||void 0===s?void 0:null===(t=s.content)||void 0===t?void 0:t.split("\n").map(e=>(0,a.jsx)("div",{children:e},e)),(0,a.jsxs)("span",{className:"absolute bottom-1 right-2 flex items-center gap-1",children:["read"===e.status&&(0,a.jsx)(i(),{src:l.Er,height:14,alt:"read"}),"delivered"===e.status&&(0,a.jsx)(i(),{src:l.Yv,height:14,alt:"delivered"}),"failed"===e.status&&(0,a.jsx)(i(),{src:l.f,height:14,alt:"failed"})]})]})}),(0,a.jsx)("div",{className:"flex mt-1 items-center text-xs font-medium leading-tight text-neutral-400\n                          ".concat("user"===e.by?"justify-start":"justify-end","\n                        "),children:ex(Number(e.time))})]})});case"image":return(0,a.jsx)("div",{className:"flex my-1 ".concat("user"===e.by?"justify-end":"justify-start"),children:(0,a.jsx)(Y,{orgId:ei,mediaId:"".concat(null===(c=JSON.parse(e.data))||void 0===c?void 0:null===(o=c.message)||void 0===o?void 0:null===(r=o.content)||void 0===r?void 0:r.id),thread_id:S,content_type:"".concat(null===(h=JSON.parse(e.data))||void 0===h?void 0:null===(u=h.message)||void 0===u?void 0:null===(d=u.content)||void 0===d?void 0:d.mime_type)})});case"video":return(0,a.jsx)("div",{className:"flex my-1 ".concat("user"===e.by?"justify-end":"justify-start"),children:(0,a.jsx)(Y,{orgId:ei,mediaId:"".concat(null===(p=JSON.parse(e.data))||void 0===p?void 0:null===(x=p.message)||void 0===x?void 0:null===(m=x.content)||void 0===m?void 0:m.id),thread_id:S,content_type:"".concat(null===(v=JSON.parse(e.data))||void 0===v?void 0:null===(f=v.message)||void 0===f?void 0:null===(g=f.content)||void 0===g?void 0:g.mime_type)})});case"document":return(0,a.jsx)("div",{className:"flex my-1 ".concat("user"===e.by?"justify-end":"justify-start"),children:(0,a.jsx)(Y,{orgId:ei,mediaId:"".concat(null===(j=JSON.parse(e.data))||void 0===j?void 0:null===(b=j.message)||void 0===b?void 0:null===(y=b.content)||void 0===y?void 0:y.id),thread_id:S,content_type:"".concat(null===(k=JSON.parse(e.data))||void 0===k?void 0:null===(N=k.message)||void 0===N?void 0:null===(w=N.content)||void 0===w?void 0:w.mime_type)})});default:return(0,a.jsx)("div",{})}})()})},e.id))})]},e)),0==Object.keys(v).length&&!et.current&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:"No messages available."}),p.to&&0!==Object.keys(v).length&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:(0,a.jsxs)("span",{className:"italic rounded py-[2px] px-[10px]",children:["Sending Reply With: ",p.to]})})]}),(0,a.jsx)(R,{thread:p,isAiEnabled:V,setIsAiEnabled:Z,contactBlocked:U,updateBlockStatus:eu,message:T,isMessageDropDownOPen:F,setIsMessageDropDownOPen:O,setMessage:L,sendMessageHandler:em,handleTemplateForMessage:()=>{O(!1),_.A.show("Select Template",(0,a.jsx)(M,{onClose:async e=>{e.msg&&(Z(!1),x(e,"text")),_.A.hide()},thread:p}))},isMobileView:r,setIsAi:e=>{el.current&&eh({action:"set_mode",mode:e?"auto":"manual"})}})]}):(0,a.jsxs)("div",{className:"w-100% m-auto",children:[" ",(0,a.jsx)(H,{})]})};var W=s(34648),G=s(46104);let V=e=>{var t;let{activePage:s,isMobileView:r,setActivePage:d}=e,u=(0,h.useRouter)(),{thread_id:m,profile:x}=u.query,p=o.A.currentId(),[g,f]=(0,n.useState)(null),v=(0,n.useRef)(null),y=(0,n.useCallback)(async()=>{if(m)try{let{data:e,error:t}=await c.A.doGet({path:"orgs/".concat(p,"/data/threads/").concat(m)});if(t){console.error("Error fetching invited users:",t);return}e&&e.thread&&(f(e.thread),v.current=function(e){let t=new Date;return t.setHours(0,0,0,0),e.filter(e=>{let s=new Date(e.time);return s.setHours(0,0,0,0),s.getTime()===t.getTime()}).length}(e.messages))}catch(e){console.error("Error fetching thread:",e)}},[p,m]);return(0,n.useEffect)(()=>{x&&"true"===x&&y()},[m,x,y]),(0,a.jsxs)("div",{className:"flex flex-col w-1/2 bg-white shadow-lg p-6 ".concat(r&&"Profile"===s?"w-full":"w-1/2"),children:[(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{let{thread_id:e}=u.query;u.push({pathname:"/messages",query:{thread_id:e}}),d("Message")},className:"cursor-pointer",children:(0,a.jsx)(G.A,{className:"text-gray-400"})})}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 items-center justify-center mb-4",children:[(0,a.jsx)("div",{className:"rounded-full w-24 h-24 object-cover border-2 border-gray-200 flex items-center justify-center",children:(0,a.jsx)(i(),{src:l.ff,alt:"user",width:60,height:60,className:"rounded-full w-full h-full object-cover"})}),(0,a.jsx)("h1",{className:"font-bold",children:"string"==typeof(null==g?void 0:g.data)&&JSON.parse(null==g?void 0:g.data).sender_name})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h2",{className:"text-slate-600 text-sm font-bold",children:"Recent Activity"}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(i(),{src:l.BQ,width:16,height:16,alt:"chatIcon",className:"invert-50"}),(0,a.jsxs)("span",{className:"text-[#737373] text-xs font-medium",children:[null==v?void 0:v.current," messages today"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(i(),{src:l.Qm,width:16,height:16,alt:"chatIcon",className:"invert-50"}),(0,a.jsxs)("span",{className:"text-[#737373] text-xs font-medium",children:["Last message \xa0: \xa0",(0,W.g)(Number(null==g?void 0:g.last_active_at))]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col mt-8",children:[(0,a.jsx)("h2",{className:"text-[#475569] text-sm font-bold",children:"Summary"}),(0,a.jsx)("p",{className:"text-slate-700 text-sm font-medium mt-4",children:"string"==typeof(null==g?void 0:g.data)&&(null===(t=JSON.parse(null==g?void 0:g.data).about)||void 0===t?void 0:t.summary)||"Not available"})]})]})},Z=()=>{let{query:e}=(0,h.useRouter)(),{profile:t}=e,[s,r]=(0,n.useState)("Threads"),[i,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)({}),u=o.A.currentId(),[m,x]=(0,n.useState)({}),p=(0,n.useRef)(null),g=(0,n.useCallback)(function(e,t){let s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0!==Object.keys(a).length)s=a;else{var n,r;s={id:e.id,org_id:u,thread_id:m.id,type:t,status:"sent",time:new Date().getTime().toString(),data:JSON.stringify({message:{content:e.msg},by:{name:null===(n=JSON.parse((null==m?void 0:m.data)||"{}"))||void 0===n?void 0:n.sender_name,email:null===(r=JSON.parse((null==m?void 0:m.data)||"{}"))||void 0===r?void 0:r.sender_email}}),tag:"",by:"text"==t?"bot_agent":"human_agent",agent_id:null}}d(e=>{let t=Object.keys(e).find(e=>e.includes("Today")),a={...e};if(t){var n;if(null===(n=e[t].find(e=>e.id===s.id))||void 0===n?void 0:n.id)return a}if(t)a[t]?a[t].push(s):a[t]=[s];else{let e=function(e){let t;let s=new Date(e),a=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=Math.floor((new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()-n.getTime())/864e5);if(0===r)t="Today";else if(1===r)t="Yesterday";else if(r<=6)t="".concat(r," days ago");else if(r<=29){let e=Math.floor(r/7);t="".concat(e," week ago")}else if(r<=365){let e=Math.floor(r/30);t="".concat(e," month ago")}else{let e=Math.floor(r/365);t="".concat(e," year ago")}let i=s.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),"".concat(t,", ").concat(i)}(Number(s.time));a[e]?a[e].push(s):a[e]=[s]}return a}),setTimeout(()=>{p&&p.current&&(p.current.scrollTop=p.current.scrollHeight)},10)},[u,m.id,m.data]);return(0,n.useEffect)(()=>{let e=window.matchMedia("(max-width: 767px)"),t=e=>{l(e.matches)};return t(e),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),(0,a.jsxs)("div",{className:"flex gap-[2px] flex-row",style:{height:"-webkit-fill-available"},children:[(!i||"Threads"===s)&&(0,a.jsx)(y,{activePage:s,isMobileView:i,setActivePage:r,messages:c,setMessages:d}),(!i||"Message"===s)&&(0,a.jsx)(z,{activePage:s,isMobileView:i,setActivePage:r,addMessageToList:g,thread:m,setThread:x,messages:c,setMessages:d,messagesContainerRef:p}),(!i||"Profile"===s)&&t&&"true"===t&&(0,a.jsx)(V,{activePage:s,isMobileView:i,setActivePage:r})]})}},60124:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/messages",function(){return s(58951)}])},94344:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(14232);let n=e=>{let t=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let s=s=>{t.current&&!t.current.contains(s.target)&&e()};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[e]),t}}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,2517,3753,8511,7141,2463,636,6593,8792],()=>t(60124)),_N_E=e.O()}]);